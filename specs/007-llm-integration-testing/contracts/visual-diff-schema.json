{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/sbroenne/mcp-windows/specs/007-llm-integration-testing/contracts/visual-diff-schema.json",
  "title": "Visual Diff Result Schema",
  "description": "JSON Schema for visual diff computation results",
  "type": "object",
  "required": ["beforeImage", "afterImage", "changedPixels", "totalPixels", "changePercentage", "threshold", "isSignificantChange"],
  "properties": {
    "beforeImage": {
      "type": "string",
      "description": "Filename of the before screenshot"
    },
    "afterImage": {
      "type": "string",
      "description": "Filename of the after screenshot"
    },
    "diffImage": {
      "type": "string",
      "description": "Filename of the generated diff image (if changes detected)"
    },
    "changedPixels": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of pixels that differ between images"
    },
    "totalPixels": {
      "type": "integer",
      "minimum": 1,
      "description": "Total pixels compared"
    },
    "changePercentage": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Percentage of pixels that changed"
    },
    "threshold": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "default": 1.0,
      "description": "Threshold percentage used to determine significance"
    },
    "isSignificantChange": {
      "type": "boolean",
      "description": "True if changePercentage exceeds threshold"
    },
    "pixelTolerance": {
      "type": "integer",
      "minimum": 0,
      "maximum": 255,
      "default": 10,
      "description": "Per-channel tolerance for pixel comparison (0-255)"
    },
    "computationTimeMs": {
      "type": "integer",
      "minimum": 0,
      "description": "Time taken to compute the diff in milliseconds"
    },
    "changedRegions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/region"
      },
      "description": "Bounding boxes of contiguous changed regions (optional)"
    },
    "dimensionsMismatch": {
      "type": "boolean",
      "default": false,
      "description": "True if before and after images have different dimensions"
    },
    "error": {
      "type": "string",
      "description": "Error message if diff computation failed"
    }
  },
  "$defs": {
    "region": {
      "type": "object",
      "required": ["x", "y", "width", "height"],
      "properties": {
        "x": {
          "type": "integer",
          "minimum": 0,
          "description": "Left edge of the changed region"
        },
        "y": {
          "type": "integer",
          "minimum": 0,
          "description": "Top edge of the changed region"
        },
        "width": {
          "type": "integer",
          "minimum": 1,
          "description": "Width of the changed region"
        },
        "height": {
          "type": "integer",
          "minimum": 1,
          "description": "Height of the changed region"
        }
      }
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "beforeImage": "step-1-before.png",
      "afterImage": "step-1-after.png",
      "diffImage": "step-1-diff.png",
      "changedPixels": 45000,
      "totalPixels": 8294400,
      "changePercentage": 0.54,
      "threshold": 1.0,
      "isSignificantChange": false,
      "pixelTolerance": 10,
      "computationTimeMs": 150
    },
    {
      "beforeImage": "step-2-before.png",
      "afterImage": "step-2-after.png",
      "diffImage": "step-2-diff.png",
      "changedPixels": 250000,
      "totalPixels": 8294400,
      "changePercentage": 3.01,
      "threshold": 1.0,
      "isSignificantChange": true,
      "pixelTolerance": 10,
      "computationTimeMs": 180,
      "changedRegions": [
        {
          "x": 100,
          "y": 200,
          "width": 500,
          "height": 400
        }
      ]
    }
  ]
}
